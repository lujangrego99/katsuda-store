# Ralph Progress Log
Started: 2026-01-21

## Codebase Patterns
- Monorepo con pnpm workspaces: apps/web (Next.js), apps/api (Express), packages/shared (tipos)
- Colores Katsuda en Tailwind: katsuda-900 (#1B5E20), katsuda-700 (#2E7D32), katsuda-500 (#4CAF50)
- Express usa tipos explícitos: Express, Request, Response de 'express'
- Express Router requiere tipo explícito: `const router: RouterType = Router()` para evitar TS2742
- shadcn/ui: Componentes en `@/components/ui/`, configuración en `components.json`
- Layout global: Header y Footer en layout.tsx, contenido específico en page.tsx
- API routes organizadas en `apps/api/src/routes/`, integradas en index.ts con `app.use()`
- Cart API usa header `x-session-id` para identificar carrito anónimo (no query param)

---

## 2026-01-21 22:XX - E0-S01: Crear estructura del proyecto monorepo

**Qué se implementó:**
- Monorepo con pnpm workspaces configurado
- apps/web: Next.js 14 con App Router, Tailwind, TypeScript
- apps/api: Express + TypeScript (Prisma pendiente para E0-S02)
- packages/shared: Tipos compartidos (Product, Category, Cart, Order, etc.)
- docker-compose.yml para desarrollo
- Dockerfiles para ambos servicios
- Colores de Katsuda en tailwind.config.ts

**Archivos creados:**
- pnpm-workspace.yaml
- package.json (raíz)
- apps/web/* (Next.js completo)
- apps/api/* (Express básico)
- packages/shared/* (tipos)
- docker-compose.yml
- .gitignore
- README.md

**Aprendizajes para futuras iteraciones:**
- TypeScript en Express requiere tipos explícitos para evitar TS2742
- pnpm workspaces requiere "workspace:*" en dependencias internas
- Next.js standalone output necesita estructura específica en Dockerfile

**Commit:** d2a40e1
---

## 2026-01-21 23:XX - E0-S02: Configurar conexión a PostgreSQL con Prisma

**Qué se implementó:**
- Schema Prisma con modelo Category placeholder
- Archivo .env con DATABASE_URL
- Conexión verificada con prisma db push
- Health endpoint verifica conexión a BD

**Archivos creados/modificados:**
- apps/api/src/prisma/schema.prisma (nuevo)
- apps/api/.env (nuevo - no commiteado)
- apps/api/src/index.ts (actualizado)

**Aprendizajes:**
- prisma db push sincroniza schema sin crear migraciones (útil para desarrollo rápido)
- .env debe estar en apps/api/ no en la raíz

**Commit:** 3b831f4
---

## 2026-01-21 23:XX - E0-S03: Crear CLAUDE.md del proyecto

**Qué se implementó:**
- .claude/CLAUDE.md con documentación completa
- Stack, comandos, estructura del proyecto
- Colores Katsuda con tabla de referencia
- Convenciones de código
- Webhooks de deploy de Easypanel

**Archivos creados:**
- .claude/CLAUDE.md

**Commit:** be89466
---

## 2026-01-21 23:XX - E1-S01/S02/S03: Schema completo de Prisma

**Qué se implementó:**
- Schema completo con todos los modelos del e-commerce
- Category con jerarquía padre/hijo
- Brand para marcas
- Product con precios múltiples (normal, transferencia, comparación)
- ProductImage y ProductAttribute
- Customer, Address para clientes
- Cart, CartItem con soporte anónimo (sessionId)
- Order, OrderItem con estados y guest checkout
- Admin con roles (SUPER, ADMIN, STAFF)
- Contact para mensajes
- ShippingZone para zonas de envío
- Settings singleton para configuración

**Archivos modificados:**
- apps/api/src/prisma/schema.prisma (expandido completamente)

**Aprendizajes:**
- Usar prisma db push para desarrollo rápido (sin crear archivos de migración)
- Los índices son importantes para relaciones frecuentes
- Settings con @id @default("singleton") para configuración única

**Commit:** ef12bfa
---

## 2026-01-22 - E1-S04: Seed de datos iniciales

**Qué se implementó:**
- Script seed.ts completo con upsert para idempotencia
- Categorías: Griferías (con subcategorías Cocina, Baño, Ducha), Sanitarios, Termotanques, Bombas, Hogar, Instalaciones
- Marcas: FV, Piazza, Ferrum, Roca, Aqua, DECA
- 14 productos de ejemplo con imágenes Unsplash, precios, atributos
- Admin por defecto: admin@katsuda.com.ar / katsuda2024
- Settings con info de Katsuda: teléfonos, direcciones, horarios, redes sociales
- 4 zonas de envío: Gran Mendoza, Interior Mendoza, San Juan Capital, Interior San Juan

**Archivos creados:**
- apps/api/src/prisma/seed.ts

**Aprendizajes para futuras iteraciones:**
- Usar upsert para seeds idempotentes (se puede correr múltiples veces)
- Crear IDs explícitos para entidades relacionadas para poder hacer upsert en images/attributes
- Settings singleton usa id: 'singleton' como clave única

**Commit:** 3a3f2d0
---

## 2026-01-22 - E2-S01: Layout base y navegación del frontend

**Qué se implementó:**
- Instalación y configuración de shadcn/ui con variables CSS de colores Katsuda
- Componentes UI base: Button, Input, Sheet (para menú móvil)
- Header con:
  - Top bar con teléfono y botón WhatsApp
  - Logo Katsuda con slogan
  - Navegación de categorías (desktop)
  - Menú hamburguesa (mobile) usando Sheet de Radix
  - Buscador expandible (mobile) y fijo (desktop)
  - Icono de carrito con badge de cantidad
- Footer con:
  - Descripción de la empresa
  - Info de sucursales Mendoza y San Juan (dirección, teléfono, horarios)
  - Links útiles y marcas que trabajan
  - Redes sociales (Facebook, Instagram)
  - Copyright y email
- Layout integrado en Next.js App Router (layout.tsx)
- Diseño responsive mobile-first

**Archivos creados:**
- apps/web/components.json (config shadcn/ui)
- apps/web/src/components/ui/button.tsx
- apps/web/src/components/ui/input.tsx
- apps/web/src/components/ui/sheet.tsx
- apps/web/src/components/Header.tsx
- apps/web/src/components/Footer.tsx

**Archivos modificados:**
- apps/web/package.json (nuevas dependencias: @radix-ui/react-slot, @radix-ui/react-dialog, class-variance-authority, tailwindcss-animate)
- apps/web/tailwind.config.ts (añadido darkMode, variables CSS shadcn, animaciones)
- apps/web/src/styles/globals.css (variables CSS para shadcn/ui con colores Katsuda)
- apps/web/src/app/layout.tsx (integrado Header y Footer)
- apps/web/src/app/page.tsx (simplificado, solo contenido)

**Aprendizajes para futuras iteraciones:**
- shadcn/ui puede configurarse manualmente creando components.json y copiando componentes
- Las variables CSS de shadcn/ui usan formato HSL sin "hsl()" wrapper: `122 76% 23%`
- Usar Sheet de Radix para menús móviles, es más accesible que un drawer casero
- El layout de Next.js con flex-col y flex-1 en main asegura que el footer quede abajo

**Commit:** 6435c12
---

## 2026-01-22 - E2-S02: API de productos y categorías

**Qué se implementó:**
- Rutas organizadas en `apps/api/src/routes/` (categories, brands, products)
- GET /api/categories - Lista categorías padre con hijos y conteo de productos
- GET /api/categories/:slug - Categoría con productos paginados (incluye hijos)
- GET /api/brands - Lista marcas activas con conteo de productos
- GET /api/products - Lista paginada con filtros: category, brand, priceMin, priceMax, inStock, freeShipping, search, sortBy (newest, price_asc, price_desc, name_asc, name_desc)
- GET /api/products/:slug - Detalle completo con imágenes, atributos, categoría con parent, marca y productos relacionados
- GET /api/products/featured - Productos destacados con límite configurable

**Archivos creados:**
- apps/api/src/routes/categories.ts
- apps/api/src/routes/brands.ts
- apps/api/src/routes/products.ts

**Archivos modificados:**
- apps/api/src/index.ts (integración de routers)

**Aprendizajes para futuras iteraciones:**
- Router de Express requiere tipo explícito: `const router: RouterType = Router()` para evitar TS2742
- Rutas con parámetros dinámicos (/:slug) deben ir DESPUÉS de rutas específicas (/featured)
- Usar `include: { _count: { select: { products: ... } } }` para conteo eficiente en Prisma

**Commit:** c948bbc
---

## 2026-01-22 - E2-S03: Home page

**Qué se implementó:**
- Hero banner con gradiente Katsuda (900 → 800 → 700), imagen de grifería, badge "9% OFF Transferencia"
- CTAs "Ver Catálogo" y "Contactanos" con iconos de envío y garantía
- Sección "Por qué elegirnos" con 3 cards (Confiabilidad, Efectividad, Trayectoria) con iconos Lucide
- Grid de categorías responsivo (2 cols mobile, 6 desktop) con imágenes y conteo de productos desde API
- Carousel de productos destacados con navegación prev/next, badges OFERTA y ENVÍO GRATIS
- Cards de producto con marca, nombre, precio, precio tachado y precio transferencia
- Sección de logos de marcas con efecto grayscale hover
- Formulario de contacto rápido con validación, estado de envío y feedback visual
- Diseño responsive mobile-first con controles de carousel adaptables
- Wave SVG decorativa entre hero y contenido

**Archivos creados:**
- apps/web/src/components/ui/card.tsx (componente Card de shadcn/ui)

**Archivos modificados:**
- apps/web/src/app/page.tsx (reescrito completamente con home page)

**Aprendizajes para futuras iteraciones:**
- Usar 'use client' para páginas con hooks de estado y fetch en useEffect
- El carousel simple se puede hacer con translate CSS y estado de índice
- formatPrice con Intl.NumberFormat('es-AR', {style: 'currency'}) para precios en pesos
- API_URL debe definirse con NEXT_PUBLIC_ para ser accesible en el cliente

**Commit:** 4e0b97c
---

## 2026-01-22 - E2-S04: Listado de productos con filtros

**Qué se implementó:**
- Página `/productos` con listado paginado y filtros completos
- Página `/categoria/[slug]` para filtrar por categoría con header específico
- Sidebar con filtros accordion: Categoría (con jerarquía), Marca, Precio (min-max con presets), Stock, Envío gratis
- Componente ProductCard reutilizable con badges OFERTA y ENVÍO GRATIS, overlay sin stock
- Ordenamiento: Más recientes, Precio menor/mayor, A-Z/Z-A
- Paginación inteligente con navegación (primero, actual ±2, último)
- URL params sincronizados con filtros seleccionados
- Chips de filtros activos con botón para eliminar individualmente
- Empty state cuando no hay resultados con sugerencia de acción
- Responsive mobile-first con Sheet para filtros en mobile
- Loading skeleton mientras carga

**Archivos creados:**
- apps/web/src/components/ui/checkbox.tsx (shadcn/ui)
- apps/web/src/components/ui/select.tsx (shadcn/ui)
- apps/web/src/components/ui/accordion.tsx (shadcn/ui)
- apps/web/src/components/ProductCard.tsx
- apps/web/src/components/ProductFilters.tsx
- apps/web/src/app/productos/page.tsx
- apps/web/src/app/categoria/[slug]/page.tsx

**Archivos modificados:**
- apps/web/package.json (dependencias @radix-ui/react-checkbox, @radix-ui/react-select, @radix-ui/react-accordion)

**Aprendizajes para futuras iteraciones:**
- useSearchParams requiere Suspense boundary en Next.js 14 App Router
- ProductFilters acepta onMobileClose callback para cerrar Sheet después de aplicar filtros
- Usar URLSearchParams para manipular query params manteniendo los existentes
- Los componentes de filtro pueden redirigir a /productos o mantener la ruta actual según contexto

**Commit:** e9defaa
---

## 2026-01-22 - E2-S05: Página de detalle de producto

**Qué se implementó:**
- Ruta /productos/[slug] con página de detalle completa
- Breadcrumb dinámico: Inicio > Categoría padre (si existe) > Categoría > Producto
- Galería de imágenes con imagen principal grande y thumbnails seleccionables
- Info de producto: marca, SKU, nombre, precios (normal, transferencia con 9% OFF), cuotas (12 sin interés)
- Indicador de stock con advertencia de últimas unidades
- Selector de cantidad con botones +/- y validación de stock máximo
- Botón "Agregar al carrito" (placeholder, se conectará en E3-S02)
- Calculadora de envío por código postal con lógica simulada para Mendoza y San Juan
- Tabs con Descripción y Especificaciones (atributos, peso, dimensiones)
- Sección de productos relacionados usando ProductCard
- Meta tags SEO dinámicos con generateMetadata de Next.js
- Open Graph tags para compartir en redes sociales
- JSON-LD Schema.org para Product y BreadcrumbList

**Archivos creados:**
- apps/web/src/app/productos/[slug]/page.tsx (Server Component con metadata)
- apps/web/src/app/productos/[slug]/ProductDetail.tsx (Client Component UI)
- apps/web/src/components/ui/tabs.tsx (componente Tabs de shadcn/ui)

**Archivos modificados:**
- apps/web/package.json (dependencia @radix-ui/react-tabs)

**Aprendizajes para futuras iteraciones:**
- Para SEO dinámico en Next.js 14, usar Server Component con generateMetadata y Client Component separado para UI
- JSON-LD schema se inyecta con dangerouslySetInnerHTML en el Server Component
- La calculadora de envío básica se puede simular con rangos de código postal hasta implementar API completa
- El botón agregar al carrito es placeholder - se integrará cuando exista CartContext en E3-S02

**Commit:** d35bd3a
---

## 2026-01-22 - E3-S01: API de carrito

**Qué se implementó:**
- GET /api/cart - Obtener carrito actual usando header x-session-id
- POST /api/cart/items - Agregar producto con validación de stock
- PATCH /api/cart/items/:id - Actualizar cantidad (si quantity=0, elimina el item)
- DELETE /api/cart/items/:id - Eliminar producto del carrito
- Carrito anónimo por sessionId para guest checkout
- Validación de stock en todas las operaciones (agregar, actualizar)
- Respuesta incluye subtotal normal y subtotal con precio transferencia

**Archivos creados:**
- apps/api/src/routes/cart.ts

**Archivos modificados:**
- apps/api/src/index.ts (integración del cartRouter)

**Aprendizajes para futuras iteraciones:**
- El sessionId se pasa via header `x-session-id` en lugar de query param para mejor seguridad
- CartItem tiene constraint único cartId_productId, usar findUnique con ese compound key
- getOrCreateCart pattern para asegurar que siempre existe un carrito
- Respuesta incluye itemCount, subtotal y transferSubtotal para uso en UI

**Commit:** d005ca3
---

## 2026-01-22 - E3-S02: Carrito de compras UI

**Qué se implementó:**
- CartContext con estado global del carrito usando React Context
- Persistencia de sessionId en localStorage para identificar carritos anónimos
- Página /carrito con:
  - Lista de productos con imagen, nombre, marca, SKU, precio y subtotal
  - Botones +/- para modificar cantidad con validación de stock
  - Botón eliminar producto
  - Resumen del pedido: subtotal, envío (pendiente), total
  - Precio con transferencia (9% OFF) destacado
  - Botones "Finalizar compra" y "Seguir comprando"
- Empty state cuando el carrito está vacío con:
  - Mensaje e icono descriptivo
  - Botón para ver productos
  - Grid de productos destacados como sugerencias
- Mini-carrito en header con contador dinámico (oculto cuando está vacío)
- Botón agregar al carrito en página de producto con estados:
  - Normal con icono de carrito
  - Loading con spinner mientras agrega
  - Confirmación verde con checkmark por 2 segundos

**Archivos creados:**
- apps/web/src/context/CartContext.tsx (estado global del carrito)
- apps/web/src/app/carrito/page.tsx (página del carrito)

**Archivos modificados:**
- apps/web/src/app/layout.tsx (integración de CartProvider)
- apps/web/src/components/Header.tsx (contador del carrito dinámico)
- apps/web/src/app/productos/[slug]/page.tsx (conexión con CartContext)

**Aprendizajes para futuras iteraciones:**
- CartProvider debe envolver todo el layout para acceso global
- El sessionId se genera con timestamp + random para evitar colisiones
- Usar estados de feedback (loading, success) para mejor UX en botones de acción
- El contador del carrito se oculta cuando itemCount es 0 para mejor estética

**Commit:** 732938b
---

## 2026-01-22 - E3-S03: API de checkout y pedidos

**Qué se implementó:**
- POST /api/checkout - Crear pedido desde carrito completo:
  - Validación de datos de contacto y dirección (si es envío a domicilio)
  - Validación de stock de todos los productos antes de confirmar
  - Cálculo de subtotal con soporte para precio transferencia
  - Cálculo de envío según zona y monto mínimo para envío gratis
  - Generación de número de pedido único formato KAT-YYMMDD-XXXX
  - Transacción atómica: crear pedido, reducir stock, vaciar carrito
- GET /api/orders/:orderNumber - Ver detalle de pedido con productos e imágenes
- POST /api/shipping/calculate - Calcular envío por código postal:
  - Detecta provincia/zona por rangos de códigos postales
  - Retorna opciones de envío a domicilio y retiro en sucursal
  - Calcula envío gratis si supera monto mínimo configurado
- GET /api/shipping/zones - Listar zonas de envío activas

**Archivos creados:**
- apps/api/src/routes/checkout.ts
- apps/api/src/routes/orders.ts
- apps/api/src/routes/shipping.ts

**Archivos modificados:**
- apps/api/src/index.ts (integración de checkoutRouter, ordersRouter, shippingRouter)

**Aprendizajes para futuras iteraciones:**
- Usar Prisma.$transaction para operaciones atómicas que deben ejecutarse todas o ninguna
- Prisma.Decimal para operaciones matemáticas con precios (evita errores de punto flotante)
- El número de pedido se genera buscando el último del día y sumando 1 al secuencial
- Las rutas de shipping usan mapeo de rangos de códigos postales a zonas

**Commit:** 7be1eaf
---

## 2026-01-22 - E3-S04: Checkout UI

**Qué se implementó:**
- Página /checkout con flujo completo de 5 pasos
- Stepper visual para navegación entre pasos
- Paso 1: Formulario de datos de contacto (email, nombre, apellido, teléfono)
- Paso 2: Formulario de dirección de envío (calle, número, piso, depto, ciudad, provincia, CP)
  - Para retiro en sucursal: solo muestra selección de provincia y sucursal
- Paso 3: Selector de método de envío con cálculo automático vía API
  - Retiro en sucursal (gratis)
  - Envío a domicilio con precio calculado y opción de envío gratis
- Paso 4: Selector de método de pago
  - Transferencia bancaria (9% OFF) con datos bancarios
  - Efectivo en local
- Paso 5: Confirmación con resumen completo de datos, productos y totales
- Resumen del pedido siempre visible en sidebar derecho
- Validación de formularios con mensajes de error
- Página de éxito con número de pedido y datos de transferencia
- Vaciar carrito automáticamente al confirmar pedido
- Componentes UI nuevos: Label, RadioGroup (shadcn/ui)
- Extensión de CartContext con clearCart y getSessionId

**Archivos creados:**
- apps/web/src/app/checkout/page.tsx (página completa de checkout)
- apps/web/src/components/ui/label.tsx (componente Label shadcn/ui)
- apps/web/src/components/ui/radio-group.tsx (componente RadioGroup shadcn/ui)

**Archivos modificados:**
- apps/web/src/context/CartContext.tsx (agregado clearCart y getSessionId)
- apps/web/package.json (nuevas dependencias @radix-ui/react-label, @radix-ui/react-radio-group)

**Aprendizajes para futuras iteraciones:**
- Para evitar warnings de ESLint con dependencias de useEffect que no deben triggerar re-runs, usar useRef para almacenar callbacks
- El stepper visual se puede hacer con CSS flexbox y líneas conectoras absolutas
- Los pasos del checkout comparten estado via el formulario padre y solo manejan su parte
- Calcular envío dinámicamente cuando el usuario ingresa el código postal usando la API existente

**Commit:** 43a18ee
---

## 2026-01-22 - E4-S01: API de autenticación admin

**Qué se implementó:**
- POST /api/admin/login - Login con email/password que retorna JWT
- GET /api/admin/me - Obtener datos del admin autenticado
- Middleware authMiddleware para proteger rutas que requieren autenticación
- Helper generateToken para generar tokens JWT con payload tipado
- Helper requireRole para verificar roles mínimos (SUPER, ADMIN, STAFF)
- Extensión de Express.Request para incluir datos del admin autenticado
- Actualización de lastLogin al hacer login exitoso
- Validación de usuario activo en cada request autenticado

**Archivos creados:**
- apps/api/src/middleware/auth.ts (middleware y helpers de autenticación)
- apps/api/src/routes/admin/auth.ts (endpoints de login y me)

**Archivos modificados:**
- apps/api/src/index.ts (integración del adminAuthRouter)

**Aprendizajes para futuras iteraciones:**
- Usar declare global para extender Express.Request con tipos personalizados
- El middleware authMiddleware debe extraer token de Authorization header (Bearer token)
- Las rutas admin van en carpeta /routes/admin/ para organización
- JWT_SECRET debe venir de variable de entorno en producción
- bcrypt.compare para verificar contraseñas hasheadas

**Commit:** ebb3450
---

## 2026-01-22 - E4-S02: Layout y dashboard admin

**Qué se implementó:**
- Página /admin/login con formulario de autenticación (email/password)
- Layout del admin con sidebar de navegación (desktop fijo, mobile Sheet)
- Navegación: Dashboard, Productos, Categorías, Marcas, Pedidos, Mensajes, Configuración
- Endpoint GET /api/admin/dashboard con métricas:
  - Pedidos pendientes (count)
  - Ventas del día (suma de pedidos no cancelados)
  - Productos con bajo stock (stock <= 5)
  - Mensajes sin leer (count)
  - Lista de pedidos recientes (últimos 5)
  - Lista de productos con bajo stock (top 5)
- Dashboard UI con cards de métricas y listas interactivas
- AdminAuthContext para manejo de autenticación con:
  - Persistencia de token en localStorage
  - Verificación de token con /api/admin/me
  - Logout y limpieza de sesión
  - Redirección automática a /admin/login si no autenticado
- Header del admin con menú mobile, título de página y datos del usuario
- Protección de rutas admin mediante context (redirect si no hay token)

**Archivos creados:**
- apps/api/src/routes/admin/dashboard.ts
- apps/web/src/app/admin/layout.tsx
- apps/web/src/app/admin/page.tsx (dashboard)
- apps/web/src/app/admin/login/page.tsx
- apps/web/src/components/admin/AdminSidebar.tsx
- apps/web/src/components/admin/AdminHeader.tsx
- apps/web/src/context/AdminAuthContext.tsx

**Archivos modificados:**
- apps/api/src/index.ts (integración adminDashboardRouter)

**Aprendizajes para futuras iteraciones:**
- El layout de admin usa pathname para detectar si es /admin/login y no mostrar sidebar/header
- AdminAuthContext usa useEffect para verificar token al montar, con fallback a cache en localStorage
- Las métricas del dashboard se calculan server-side con Prisma aggregations
- El nombre del cliente se unifica de customer (registrado) o guestName/guestEmail (guest)
- Sheet de Radix se reutiliza para menú mobile del admin

**Commit:** 5261913
---

## 2026-01-22 - E4-S03: CRUD de productos en admin

**Qué se implementó:**
- API CRUD completa para productos admin:
  - GET /api/admin/products - Lista paginada con filtros (search, category, brand, lowStock, isActive)
  - GET /api/admin/products/:id - Detalle completo para edición
  - POST /api/admin/products - Crear producto con imágenes y atributos
  - PATCH /api/admin/products/:id - Actualizar producto (incluye reemplazo de imágenes/atributos)
  - DELETE /api/admin/products/:id - Eliminar producto (protección si tiene pedidos)
  - PATCH /api/admin/products/:id/toggle - Activar/desactivar producto
- Página /admin/productos con:
  - Tabla de productos con imagen, nombre, SKU, categoría, precio, stock, estado
  - Filtros: búsqueda, categoría, marca, solo bajo stock, estado activo
  - Paginación con navegación
  - Switch para activar/desactivar productos
  - Botones de editar y eliminar con confirmación
- Formulario de producto con tabs:
  - Básico: SKU, nombre, categoría, marca, descripción corta/larga, stock, opciones (activo, destacado, envío gratis)
  - Precios: precio, precio comparación, precio transferencia, costo, peso, dimensiones
  - Imágenes: agregar URLs de imágenes, reordenar, eliminar
  - Atributos: especificaciones técnicas dinámicas (nombre/valor)
  - SEO: título, descripción, tags
- Componentes shadcn/ui nuevos: Table, Badge, Dialog, Textarea, Switch

**Archivos creados:**
- apps/api/src/routes/admin/products.ts
- apps/web/src/app/admin/productos/page.tsx
- apps/web/src/app/admin/productos/ProductForm.tsx
- apps/web/src/components/ui/table.tsx
- apps/web/src/components/ui/badge.tsx
- apps/web/src/components/ui/dialog.tsx
- apps/web/src/components/ui/textarea.tsx
- apps/web/src/components/ui/switch.tsx

**Archivos modificados:**
- apps/api/src/index.ts (integración adminProductsRouter)
- apps/web/package.json (nueva dependencia @radix-ui/react-switch)

**Aprendizajes para futuras iteraciones:**
- Para formularios complejos con datos que se cargan via API, pasar solo el ID y que el formulario cargue los datos
- Usar Prisma.$transaction para operaciones que modifican múltiples entidades relacionadas (producto + imágenes + atributos)
- El patrón de generar slug a partir del nombre con timestamp fallback evita colisiones
- Validar antes de eliminar si hay relaciones (orderItems) para evitar pérdida de datos históricos

**Commit:** 1153004
---

## 2026-01-22 - E4-S04: Gestión de categorías y marcas en admin

**Qué se implementó:**
- API CRUD para categorías admin con soporte de jerarquía padre/hijo:
  - GET /api/admin/categories - Lista jerárquica con hijos y conteo de productos
  - GET /api/admin/categories/all - Lista plana para selects
  - GET /api/admin/categories/:id - Detalle de categoría
  - POST /api/admin/categories - Crear categoría
  - PATCH /api/admin/categories/:id - Actualizar categoría
  - DELETE /api/admin/categories/:id - Eliminar (validando que no tenga hijos ni productos)
  - PATCH /api/admin/categories/:id/toggle - Activar/desactivar
  - PATCH /api/admin/categories/reorder - Reordenar categorías
- API CRUD para marcas admin:
  - GET /api/admin/brands - Lista paginada con búsqueda y filtros
  - GET /api/admin/brands/all - Lista plana para selects
  - GET /api/admin/brands/:id - Detalle de marca
  - POST /api/admin/brands - Crear marca
  - PATCH /api/admin/brands/:id - Actualizar marca
  - DELETE /api/admin/brands/:id - Eliminar (validando que no tenga productos)
  - PATCH /api/admin/brands/:id/toggle - Activar/desactivar
- UI de gestión de categorías (/admin/categorias):
  - Tabla con visualización jerárquica (padre con hijos indentados)
  - Formulario de creación/edición con selector de categoría padre
  - Switch para activar/desactivar
  - Botones de editar y eliminar con confirmación
  - Validación de eliminación mostrando productos y subcategorías asociadas
- UI de gestión de marcas (/admin/marcas):
  - Tabla con búsqueda y filtro por estado
  - Paginación
  - Formulario de creación/edición con preview de logo
  - Switch para activar/desactivar
  - Botones de editar y eliminar con confirmación

**Archivos creados:**
- apps/api/src/routes/admin/categories.ts
- apps/api/src/routes/admin/brands.ts
- apps/web/src/app/admin/categorias/page.tsx
- apps/web/src/app/admin/marcas/page.tsx

**Archivos modificados:**
- apps/api/src/index.ts (integración adminCategoriesRouter, adminBrandsRouter)
- apps/api/src/middleware/auth.ts (fix lint warning para namespace)

**Aprendizajes para futuras iteraciones:**
- Las categorías jerárquicas limitan a 2 niveles máximo para simplicidad
- Validar antes de eliminar entidades con relaciones (productos, subcategorías)
- El endpoint /all retorna lista plana útil para selectores en formularios
- Para namespace en Express con declare global, usar eslint-disable-next-line en la línea del namespace

**Commit:** c42a634
---

## 2026-01-22 - E4-S05: Gestion de pedidos en admin

**Que se implemento:**
- API CRUD para pedidos admin:
  - GET /api/admin/orders - Lista paginada con filtros (status, paymentStatus, dateFrom, dateTo, search)
  - GET /api/admin/orders/:id - Detalle completo del pedido con items, cliente y direccion
  - PATCH /api/admin/orders/:id - Actualizar estado, paymentStatus y notas
  - GET /api/admin/orders/stats/summary - Estadisticas de pedidos por estado
- UI de gestion de pedidos (/admin/pedidos):
  - Tabla con busqueda por numero de pedido, email o nombre
  - Filtros por estado del pedido, estado de pago y rango de fechas
  - Paginacion
  - Vista de detalle del pedido en modal:
    - Datos del cliente (nombre, email, telefono)
    - Direccion de envio o indicacion de retiro en sucursal
    - Lista de productos con imagen, SKU, cantidad y precios
    - Resumen de totales (subtotal, envio, descuento, total)
    - Cambio de estado con transiciones validas (ej: PENDING solo puede ir a CONFIRMED o CANCELLED)
    - Cambio de estado de pago
    - Notas internas editables

**Archivos creados:**
- apps/api/src/routes/admin/orders.ts
- apps/web/src/app/admin/pedidos/page.tsx

**Archivos modificados:**
- apps/api/src/index.ts (integracion adminOrdersRouter)

**Aprendizajes para futuras iteraciones:**
- Las transiciones de estado de pedido deben validarse server-side, no solo en UI
- El objeto allowedTransitions mapea cada estado a sus posibles siguientes estados
- Para pedidos guest, los datos del cliente estan en guestName/guestEmail/guestPhone
- El detalle del pedido incluye items.product con imagen para mostrar en UI
- Las notas internas son utiles para comunicacion entre staff

**Commit:** ccb1946
---

## 2026-01-22 - E5-S01: Buscador de productos

**Qué se implementó:**
- GET /api/products/search - Endpoint de búsqueda para autocomplete
  - Busca por nombre, SKU o marca del producto
  - Limita a máximo 10 resultados (default 5)
  - Retorna productos con imagen, precio y precio transferencia
- Header actualizado con autocomplete completo:
  - Debounce de 300ms para evitar requests excesivos
  - Hasta 5 sugerencias con imagen, nombre, marca, SKU y precios
  - Dropdown con resaltado del término buscado
  - Botón "Ver todos los resultados" para ir a /buscar
  - Soporte mobile con Sheet expandible
- Página /buscar con resultados completos:
  - Input de búsqueda grande y prominente
  - Grid de productos con paginación
  - Sidebar con filtros (categoría, marca, precio, stock, envío gratis)
  - Chips de filtros activos con opción de eliminar
  - Empty states para sin búsqueda y sin resultados
- Resaltado de términos de búsqueda:
  - ProductCard acepta prop searchQuery opcional
  - Función highlightMatch resalta coincidencias en nombre, marca y SKU
  - Usar tag <mark> con fondo amarillo para resaltar

**Archivos creados:**
- apps/web/src/app/buscar/page.tsx (página de búsqueda completa)

**Archivos modificados:**
- apps/api/src/routes/products.ts (endpoint /search)
- apps/web/src/components/Header.tsx (autocomplete con debounce)
- apps/web/src/components/ProductCard.tsx (prop searchQuery y highlight)
- apps/web/src/components/ProductFilters.tsx (prop basePath para reutilización)

**Aprendizajes para futuras iteraciones:**
- useEffect con setTimeout + cleanup es un patrón simple para debounce
- Para autocomplete, usar refs y useEffect para detectar clicks afuera
- La función highlightMatch debe escapar caracteres regex especiales en el query
- Reutilizar ProductFilters pasando basePath permite usarlo en múltiples páginas
- Al limpiar filtros en /buscar, mantener el query param q para preservar la búsqueda

**Commit:** 9ac70f0
---

## 2026-01-22 - E5-S02: Calculadora de envio

**Que se implemento:**
- API /api/shipping/calculate mejorada:
  - Soporte para productPrice (producto individual) y cartTotal (carrito)
  - Mapeo de codigos postales mas detallado para Gran Mendoza (5500-5549) y San Juan Capital (5400-5413)
  - Calculo de envio gratis si supera monto minimo configurado
  - Mensaje informativo de cuanto falta para envio gratis
  - Direcciones de sucursales dinamicas desde Settings
- Calculadora de envio en pagina de producto:
  - Conectada a la API real (antes era simulada)
  - Muestra precio de envio, tiempo estimado de entrega
  - Muestra opciones de retiro gratis en sucursal
  - Indica si hay envio gratis y cuanto falta para obtenerlo
- Calculadora de envio en pagina de carrito:
  - Input de CP con calculo via API
  - Muestra envio a domicilio con precio
  - Muestra retiro gratis con direcciones de sucursales
  - Total dinamico incluyendo envio
- API CRUD admin para zonas de envio:
  - GET /api/admin/shipping/zones - Lista zonas con filtros
  - POST /api/admin/shipping/zones - Crear zona
  - PATCH /api/admin/shipping/zones/:id - Actualizar zona
  - DELETE /api/admin/shipping/zones/:id - Eliminar zona
  - PATCH /api/admin/shipping/zones/:id/toggle - Activar/desactivar
- Pagina admin /admin/envios:
  - Tabla con zonas de envio configuradas
  - Formulario para crear/editar zonas
  - Filtro por provincia
  - Switch para activar/desactivar zonas
  - Botones de editar y eliminar

**Archivos creados:**
- apps/api/src/routes/admin/shipping.ts
- apps/web/src/app/admin/envios/page.tsx

**Archivos modificados:**
- apps/api/src/index.ts (integracion adminShippingRouter)
- apps/api/src/routes/shipping.ts (mejoras en calculo)
- apps/web/src/app/productos/[slug]/page.tsx (calculadora con API real)
- apps/web/src/app/carrito/page.tsx (calculadora de envio agregada)
- apps/web/src/components/admin/AdminSidebar.tsx (link a envios)

**Aprendizajes para futuras iteraciones:**
- El endpoint /calculate puede recibir productPrice o cartTotal segun el contexto
- Los rangos de codigos postales deben ser mas granulares para diferenciar zonas urbanas
- El estado shippingData es mejor que shippingResult (string) para mostrar UI compleja
- El calculo de amountForFreeShipping ayuda a incentivar compras mayores

**Commit:** f42f8fc
---

## 2026-01-22 - E5-S03: Boton flotante WhatsApp

**Que se implemento:**
- Boton flotante verde en esquina inferior derecha con icono de WhatsApp
- Tooltip "Chatea con nosotros" al hacer hover
- Animacion de escala al hacer hover
- Mensajes contextuales segun la pagina actual:
  - En producto: "Hola! Me interesa [nombre] SKU [sku]"
  - En carrito: "Hola! Quiero consultar por mi carrito"
  - En checkout: "Hola! Tengo una consulta sobre mi pedido"
  - En home/otras: "Hola! Quiero hacer una consulta"
- API endpoint GET /api/settings para obtener configuracion publica
- WhatsAppContext para compartir info del producto actual entre componentes
- Numero WhatsApp configurable desde Settings (ya existia en DB)
- Boton oculto en paginas de admin

**Archivos creados:**
- apps/api/src/routes/settings.ts (endpoint publico de settings)
- apps/web/src/components/WhatsAppButton.tsx (componente del boton)
- apps/web/src/context/WhatsAppContext.tsx (contexto para info de producto)

**Archivos modificados:**
- apps/api/src/index.ts (integracion settingsRouter)
- apps/web/src/app/layout.tsx (integracion WhatsAppProvider y WhatsAppButton)
- apps/web/src/app/productos/[slug]/page.tsx (set productInfo en contexto)

**Aprendizajes para futuras iteraciones:**
- Usar Context para compartir estado entre componentes que no estan en jerarquia directa
- El cleanup function en useEffect es importante para limpiar estado al salir de una pagina
- Los botones flotantes deben tener z-index alto (z-50) para aparecer sobre todo el contenido
- Ocultar elementos en ciertas rutas con pathname?.startsWith('/admin')

**Commit:** 0ce9e68
---

## 2026-01-22 - E5-S04: Pagina de contacto

**Que se implemento:**
- POST /api/contact - Endpoint para guardar mensajes de contacto
  - Validacion de campos requeridos (nombre, email, mensaje)
  - Validacion de formato de email
  - Captcha basico validado
- Pagina /contacto con formulario completo:
  - Campos: nombre, email, telefono, provincia, asunto, mensaje
  - Validacion de formulario client-side con mensajes de error
  - Captcha basico con operacion matematica (suma)
  - Estado de exito con mensaje de confirmacion
- Info de sucursales:
  - Mendoza: direccion, telefono
  - San Juan: direccion, telefono
  - Datos dinamicos desde Settings API
- Horarios de atencion (L-V y Sabados)
- CTA de WhatsApp con mensaje contextual
- API admin para gestionar mensajes:
  - GET /api/admin/messages - Lista paginada con filtros
  - GET /api/admin/messages/:id - Detalle
  - PATCH /api/admin/messages/:id/read - Marcar como leido
  - PATCH /api/admin/messages/:id/unread - Marcar como no leido
  - PATCH /api/admin/messages/read-all - Marcar todos como leidos
  - DELETE /api/admin/messages/:id - Eliminar
- Pagina admin /admin/mensajes:
  - Tabla de mensajes con filtros y busqueda
  - Cards de estadisticas (total, sin leer, leidos)
  - Modal de detalle con info del remitente
  - Acciones: marcar leido/no leido, eliminar, responder por email

**Archivos creados:**
- apps/api/src/routes/contact.ts
- apps/api/src/routes/admin/messages.ts
- apps/web/src/app/contacto/page.tsx
- apps/web/src/app/admin/mensajes/page.tsx

**Archivos modificados:**
- apps/api/src/index.ts (integracion contactRouter y adminMessagesRouter)

**Aprendizajes para futuras iteraciones:**
- Captcha basico con operaciones matematicas es suficiente para proteccion inicial
- generateCaptcha retorna un objeto {question, answer} que se regenera al cambiar
- El endpoint read-all debe ir ANTES del /:id para que Express no lo interprete como parametro
- formatRelativeDate ayuda a mostrar tiempos legibles ("Hace 5 min", "Hace 2 dias")

**Commit:** 7d6e17c
---

## 2026-01-22 - E6-S01: SEO meta tags y Open Graph

**Que se implemento:**
- Layout mejorado con metadata base completa:
  - metadataBase para URLs absolutas
  - title con template "%s | Katsuda"
  - description optimizada con palabras clave
  - keywords extendidas
  - Open Graph completo con imagen, locale y siteName
  - Twitter cards con summary_large_image
  - robots con directivas de indexacion
- Pagina de producto con metadata dinamica:
  - generateMetadata que obtiene datos del producto via fetch
  - Title y description dinamicos con nombre, marca, precio
  - Open Graph con imagen del producto
  - Twitter cards
  - Canonical URL
  - Schema.org Product con datos estructurados:
    - name, description, sku, image, brand
    - offers con price, availability, seller
  - Schema.org BreadcrumbList para navegacion
- Refactorizacion de paginas a Server + Client Components:
  - productos/[slug]/page.tsx (Server) + ProductDetailClient.tsx (Client)
  - productos/page.tsx (Server) + ProductsClient.tsx (Client)
  - categoria/[slug]/page.tsx (Server con generateMetadata) + CategoryClient.tsx (Client)
  - contacto/page.tsx (Server) + ContactClient.tsx (Client)
  - buscar/page.tsx (Server) + SearchClient.tsx (Client)
- Metadata estatica en paginas principales:
  - /productos: titulo y descripcion para catalogo
  - /categoria/[slug]: metadata dinamica con nombre de categoria
  - /contacto: titulo y descripcion con sucursales
  - /buscar: robots noindex para evitar indexacion de busquedas

**Archivos creados:**
- apps/web/src/app/productos/[slug]/ProductDetailClient.tsx
- apps/web/src/app/productos/ProductsClient.tsx
- apps/web/src/app/categoria/[slug]/CategoryClient.tsx
- apps/web/src/app/contacto/ContactClient.tsx
- apps/web/src/app/buscar/SearchClient.tsx

**Archivos modificados:**
- apps/web/src/app/layout.tsx (metadata base completa)
- apps/web/src/app/productos/[slug]/page.tsx (refactorizado a Server Component)
- apps/web/src/app/productos/page.tsx (metadata + wrapper)
- apps/web/src/app/categoria/[slug]/page.tsx (generateMetadata)
- apps/web/src/app/contacto/page.tsx (metadata + wrapper)
- apps/web/src/app/buscar/page.tsx (metadata + wrapper)

**Aprendizajes para futuras iteraciones:**
- Para SEO dinamico en Next.js 14+, separar Server Component (metadata) y Client Component (UI)
- generateMetadata usa Promise<{ slug: string }> para params en Next.js 15
- Schema.org Product requiere priceValidUntil para Google Rich Results
- metadataBase en layout permite usar URLs relativas en todo el sitio
- robots: noindex en paginas de busqueda evita contenido duplicado

**Commit:** cf84595
---
